<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>9999 Leef Planning • LEEF</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="9999 Leef Planning">
<meta property="og:description" content="LEEF">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LEEF</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/c_01_background_leef.html">01 Background LEEF Data</a>
    </li>
    <li>
      <a href="../articles/c_02_pipeline_management.html">02 Pipeline Management</a>
    </li>
    <li>
      <a href="../articles/c_03_running_pipeline_manual.html">03 Manual Pipeline Management</a>
    </li>
    <li>
      <a href="../articles/c_04_pipeline_server_admin.html">04 Pipeline Server Admin Guide</a>
    </li>
    <li>
      <a href="../articles/d_101_RRD_Description.html">101 RRD Description</a>
    </li>
    <li>
      <a href="../articles/d_102_create_LEEF_docker_host.html">102 Create LEEF docker Host</a>
    </li>
    <li>
      <a href="../articles/e_1001_start_pipeline_checklist.html">1001 Start Pipeline Checklist</a>
    </li>
    <li>
      <a href="../articles/x_9999_Leef_Planning.html">9999 Leef Planning</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/LEEF-UZH/LEEF/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="x_9999_Leef_Planning_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>9999 Leef Planning</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LEEF-UZH/LEEF/blob/master/vignettes/x_9999_Leef_Planning.Rmd"><code>vignettes/x_9999_Leef_Planning.Rmd</code></a></small>
      <div class="hidden name"><code>x_9999_Leef_Planning.Rmd</code></div>

    </div>

    
    
<div id="important" class="section level1">
<h1 class="hasAnchor">
<a href="#important" class="anchor"></a><strong>Important</strong>
</h1>
<p>**<span style="color:red"> The whole document needs to be re-worked and does not reflect the current design! It is based on the initial planning and has not been updated.</span></p>
<p>It does not reflect the actual package and day=tabase!!!!</p>
<p>TODO: Update this document! **</p>
</div>
<div id="ideas" class="section level1">
<h1 class="hasAnchor">
<a href="#ideas" class="anchor"></a>Ideas</h1>
<ul>
<li><p>The workflow should be separated from the functionality, i.e. R package containing functionality, scripts (or other packages) which contain the workflow load the functionality package and condtrol the analysis.</p></li>
<li><p>the forecast should be triggered automatically after the data has been updated, thus the forecasts are perfectly in sync with the data. The Forecast repo will contain a link to the tag of the data used for the last release. it would be ideal to have the same tags for Data release and Forecast release.</p></li>
</ul>
<div id="trusted-timestamps-in-progress" class="section level2">
<h2 class="hasAnchor">
<a href="#trusted-timestamps-in-progress" class="anchor"></a>Trusted Timestamps <strong><span style="color:green">IN PROGRESS</span></strong>
</h2>
<p>Trusted Timestamps will be automatically created using the <code>ROriginStamp</code> package when data is archived.</p>
</div>
</div>
<div id="local-processing" class="section level1">
<h1 class="hasAnchor">
<a href="#local-processing" class="anchor"></a>Local Processing</h1>
<div id="current-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#current-processing" class="anchor"></a>Current processing</h2>
<div class="figure">
<img src="localProcessingCurrent.png" style="width:100.0%" alt=""><p class="caption">localProcessingCurrent</p>
</div>
<p>All file sizes are per sample.</p>
<div id="flow-cytometry" class="section level3">
<h3 class="hasAnchor">
<a href="#flow-cytometry" class="anchor"></a>Flow Cytometry</h3>
<ol style="list-style-type: decimal">
<li>Machine output <code>.c6</code>
</li>
<li>R script
<ol start="2" style="list-style-type: decimal">
<li>
<code>BioBase</code> package reads <code>.fca</code> into R, and</li>
<li>further processing and gating by using <code>flowCore</code>
</li>
<li>results in <code>.csv</code> with count of particles of gated dataset</li>
</ol>
</li>
</ol>
<div id="file-size" class="section level4">
<h4 class="hasAnchor">
<a href="#file-size" class="anchor"></a>File Size</h4>
<ul>
<li>
<strong>raw data (<code>.c6</code>):</strong> <span class="math inline">\(100 \dots 200MB\)</span>
</li>
<li>
<strong>final data (<code>.csv</code>):</strong> <span class="math inline">\(1 \dots 2MB\)</span>
</li>
</ul>
</div>
<div id="todo" class="section level4">
<h4 class="hasAnchor">
<a href="#todo" class="anchor"></a><strong><span style="color:red">TODO</span></strong>
</h4>
<ul>
<li>convert R script into package</li>
<li>is it usefull to archive <code>.c6</code> or file or the one converted to <code>.fca</code>? Large storage space requirements!!!!</li>
</ul>
</div>
</div>
<div id="flow-cam" class="section level3">
<h3 class="hasAnchor">
<a href="#flow-cam" class="anchor"></a>Flow CAM</h3>
<ol style="list-style-type: decimal">
<li>input of reference images for identification</li>
<li>automated classification of particles using reference images</li>
<li>output <code>.csv</code> with count of each species</li>
</ol>
<div id="file-size-1" class="section level4">
<h4 class="hasAnchor">
<a href="#file-size-1" class="anchor"></a>File Size</h4>
<ul>
<li>
<strong>raw data (<code>.IMAGE</code>):</strong> a lot</li>
<li>
<strong>final data (<code>.csv</code>):</strong> <span class="math inline">\(&lt;1MB\)</span>
</li>
</ul>
</div>
<div id="todo-1" class="section level4">
<h4 class="hasAnchor">
<a href="#todo-1" class="anchor"></a><strong><span style="color:red">TODO</span></strong>
</h4>
<ul>
<li>The image classification of the particles into species is done by the Flow CAM. Would it be usefull to do the classifiaction externally (reproducability?)? In this case, the same algorythms as for the Bemovi particle identification could be used.</li>
</ul>
</div>
</div>
<div id="video-bemovie" class="section level3">
<h3 class="hasAnchor">
<a href="#video-bemovie" class="anchor"></a>Video / BeMovie</h3>
<ol style="list-style-type: decimal">
<li>input of reference images for identification</li>
<li>video recording (<strong>~500MB</strong>)</li>
<li>Video analysis using <code>Bemovi</code> R package</li>
<li>classification of particles into species</li>
<li>results in <code>.csv</code> file with size info for each individual particle identified</li>
<li>can be aggregated to return only mean sizes, but not ideal as aggregated</li>
</ol>
<div id="file-size-2" class="section level4">
<h4 class="hasAnchor">
<a href="#file-size-2" class="anchor"></a>File Size</h4>
<ul>
<li>
<strong>raw data (<code>.VIDEO</code>):</strong> <span class="math inline">\(500MB\)</span>
</li>
<li>
<strong>final data (<code>.csv</code>):</strong> <span class="math inline">\(&lt;1MB\)</span>
</li>
</ul>
</div>
<div id="todo-2" class="section level4">
<h4 class="hasAnchor">
<a href="#todo-2" class="anchor"></a><strong><span style="color:red">TODO</span></strong>
</h4>
<ul>
<li>testig quality of recording. The testing of the movie should be done in Bemovi itself (add to package possibly?)
<ol style="list-style-type: decimal">
<li>processing of first seconds of the video</li>
<li>automatic recognition of errors / quality</li>
<li>assign quality value (<span class="math inline">\(1 \dots 0\)</span>)</li>
<li>depending on threshold continue processing, request re-recording, or ask for confirmation from operator</li>
</ol>
</li>
<li>analyse whole movie</li>
</ul>
</div>
</div>
<div id="manual-count" class="section level3">
<h3 class="hasAnchor">
<a href="#manual-count" class="anchor"></a>Manual Count</h3>
<ol style="list-style-type: decimal">
<li>count individuals</li>
<li>
<code>.csv</code> file with count of individuals in each species and dilution</li>
</ol>
<div id="file-size-3" class="section level4">
<h4 class="hasAnchor">
<a href="#file-size-3" class="anchor"></a>File Size</h4>
<ul>
<li>
<strong>raw data (<code>.xls</code>):</strong> <span class="math inline">\(&lt;1MB\)</span>
</li>
<li>
<strong>final data (<code>.csv</code>):</strong> <span class="math inline">\(&lt;1MB\)</span>
</li>
</ul>
</div>
<div id="todo-3" class="section level4">
<h4 class="hasAnchor">
<a href="#todo-3" class="anchor"></a><strong><span style="color:red">TODO</span></strong>
</h4>
<ul>
<li>design excel form (or similar) to make data entry safer and include initial checks</li>
</ul>
</div>
<div id="processing-to-be-done" class="section level4">
<h4 class="hasAnchor">
<a href="#processing-to-be-done" class="anchor"></a>Processing to be done</h4>
</div>
</div>
<div id="respirometer-and-temperture" class="section level3">
<h3 class="hasAnchor">
<a href="#respirometer-and-temperture" class="anchor"></a>Respirometer and Temperture</h3>
<ol style="list-style-type: decimal">
<li>results in <code>.csv</code> file with info on <span class="math inline">\(O_2\)</span> and temperature</li>
</ol>
<div id="file-size-4" class="section level4">
<h4 class="hasAnchor">
<a href="#file-size-4" class="anchor"></a>File Size</h4>
<ul>
<li>
<strong>raw data (<code>.csv</code>):</strong> <span class="math inline">\(&lt;1MB\)</span>
</li>
<li>
<strong>final data (<code>.csv</code>):</strong> <span class="math inline">\(&lt;1MB\)</span>
</li>
</ul>
</div>
<div id="todo-4" class="section level4">
<h4 class="hasAnchor">
<a href="#todo-4" class="anchor"></a><strong><span style="color:red">TODO</span></strong>
</h4>
<ul>
<li>nothing I am aware of</li>
</ul>
</div>
</div>
<div id="total-organic-carbon" class="section level3">
<h3 class="hasAnchor">
<a href="#total-organic-carbon" class="anchor"></a>Total Organic Carbon</h3>
<p>Need info from Yves.</p>
<div id="file-size-5" class="section level4">
<h4 class="hasAnchor">
<a href="#file-size-5" class="anchor"></a>File Size</h4>
<ul>
<li>
<strong>raw data (<code>.csv</code>):</strong> <span class="math inline">\(&lt;1MB\)</span>
</li>
<li>
<strong>final data (<code>.csv</code>):</strong> <span class="math inline">\(&lt;1MB\)</span>
</li>
</ul>
</div>
<div id="todo-5" class="section level4">
<h4 class="hasAnchor">
<a href="#todo-5" class="anchor"></a><strong><span style="color:red">TODO</span></strong>
</h4>
</div>
</div>
</div>
</div>
<div id="sequence-diagrams" class="section level1">
<h1 class="hasAnchor">
<a href="#sequence-diagrams" class="anchor"></a>Sequence Diagrams</h1>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<div class="figure">
<img src="seq_overview.png" style="width:100.0%" alt=""><p class="caption">seq_overview</p>
</div>
</div>
<div id="master-repos" class="section level2">
<h2 class="hasAnchor">
<a href="#master-repos" class="anchor"></a>Master Repos</h2>
<div class="figure">
<img src="sequence_detailed_main_repo.png" style="width:100.0%" alt=""><p class="caption">sequence_detailed_main_repo</p>
</div>
</div>
<div id="child-repos-public" class="section level2">
<h2 class="hasAnchor">
<a href="#child-repos-public" class="anchor"></a>Child Repos (public)</h2>
<div class="figure">
<img src="sequence_detailed_child_repo.png" style="width:100.0%" alt=""><p class="caption">sequence_detailed_child_repo</p>
</div>
<div id="remarks" class="section level3">
<h3 class="hasAnchor">
<a href="#remarks" class="anchor"></a>Remarks</h3>
<div id="doi-and-trustedtimestamp" class="section level4">
<h4 class="hasAnchor">
<a href="#doi-and-trustedtimestamp" class="anchor"></a>DOI and TrustedTimeStamp</h4>
<p>These need to be enabled in the repo itself via webhooks. Alternatively, one could also call them from R via a <code>curl</code> command - advantages would be more control?</p>
</div>
<div id="config-file-in-repo-which-specifies-properties" class="section level4">
<h4 class="hasAnchor">
<a href="#config-file-in-repo-which-specifies-properties" class="anchor"></a>config file in repo which specifies properties</h4>
<p>Format has to be human readable, YAML and one can use the package <code>config</code> <a href="https://cran.r-project.org/web/packages/config/" class="uri">https://cran.r-project.org/web/packages/config/</a> to load the configs easily. Also, one can specify the configuration for Master as well as Child repo in one config file which can be in all repos of the set.</p>
<p>Possible fields (with default valuse) could be (if one is using R instead of webhooks for DOI and TTS):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">default</span><span class="op">:</span>
  <span class="va">doi</span><span class="op">:</span> <span class="cn">FALSE</span>
  <span class="va">tts</span><span class="op">:</span> <span class="cn">TRUE</span>
  <span class="va">data</span><span class="op">:</span>
    <span class="va">backend</span><span class="op">:</span> 
    
<span class="va">master</span><span class="op">:</span>
  <span class="va">doi</span><span class="op">:</span> <span class="cn">FALSE</span>
  <span class="va">tts</span><span class="op">:</span> <span class="cn">TRUE</span>
  <span class="va">data</span><span class="op">:</span>
    <span class="va">backend</span><span class="op">:</span>
      <span class="va">mssql</span><span class="op">:</span>
        <span class="va">Database</span><span class="op">:</span> <span class="st">"[database name]"</span>
        <span class="va">UID</span><span class="op">:</span> <span class="st">"[user id]"</span>
        <span class="va">PWD</span><span class="op">:</span> <span class="st">"[pasword]"</span>
        <span class="va">Port</span><span class="op">:</span> <span class="fl">1433</span>
        
<span class="va">public</span><span class="op">:</span>
  <span class="va">doi</span><span class="op">:</span> <span class="cn">TRUE</span>
  <span class="va">tts</span><span class="op">:</span> <span class="cn">TRUE</span>
  <span class="va">data</span><span class="op">:</span>
    <span class="va">backend</span><span class="op">:</span>
      <span class="va">csv</span><span class="op">:</span>
        <span class="va">folder</span><span class="op">:</span> <span class="va">rawData</span> 

<span class="va">heatwave_e_1</span><span class="op">:</span>
  <span class="va">doi</span><span class="op">:</span> <span class="cn">TRUE</span>
  <span class="va">tts</span><span class="op">:</span> <span class="cn">TRUE</span>
  <span class="va">data</span><span class="op">:</span>
    <span class="va">backend</span><span class="op">:</span>
      <span class="va">csv</span><span class="op">:</span>
        <span class="va">folder</span><span class="op">:</span> <span class="va">rawData</span> 
  
<span class="va">heatwave</span><span class="op">:</span>
  <span class="va">doi</span><span class="op">:</span> <span class="cn">FALSE</span>
  <span class="va">tts</span><span class="op">:</span> <span class="cn">TRUE</span>
  <span class="va">data</span><span class="op">:</span>
    <span class="va">backend</span><span class="op">:</span>
      <span class="va">mysql</span><span class="op">:</span>
        <span class="va">Database</span><span class="op">:</span> <span class="st">"[database name]"</span>
        <span class="va">UID</span><span class="op">:</span> <span class="st">"[user id]"</span>
        <span class="va">PWD</span><span class="op">:</span> <span class="st">"[pasword]"</span></code></pre></div>
<p>In addition, the repo will contain one file named CONFIG_NAME which contains the name of the config to be used, e.g. <code>master</code> if it is the nmaster config</p>
</div>
</div>
<div id="questions" class="section level3">
<h3 class="hasAnchor">
<a href="#questions" class="anchor"></a>Questions</h3>
<ul>
<li>How to deal with embargoed data - date for end embargo?
<ul>
<li>
<strong>Problem</strong>: What if embargo date changes? SHould we change already older data? I don’t like this.</li>
<li>
<strong>Better</strong>: column for embargo id, where each id will be specified in meta data table, in which the final date for embargo is stored. So the actual data does not need to be changed later if the embargo needs to be extended, only the embargo table needs to be changed</li>
</ul>
</li>
<li>mor than one level of child repos necessary? I don’t think so.</li>
</ul>
<div id="data-table" class="section level4">
<h4 class="hasAnchor">
<a href="#data-table" class="anchor"></a>Data table</h4>
<table class="table">
<thead><tr class="header">
<th>data</th>
<th>child repo key</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>…</td>
<td>public_MSC_Peter</td>
</tr>
<tr class="even">
<td>…</td>
<td>public_PhD_Mary</td>
</tr>
<tr class="odd">
<td>…</td>
<td>heatwave_private</td>
</tr>
<tr class="even">
<td>…</td>
<td>heatwave</td>
</tr>
</tbody>
</table>
<p>Do we need multiple child repos? Should be easy to implement and adds flexibility.</p>
</div>
<div id="child-repo-table" class="section level4">
<h4 class="hasAnchor">
<a href="#child-repo-table" class="anchor"></a>Child Repo Table</h4>
<p>If there are not to may, a YAML config file could be used, otherwise a table. The YAML file would be easier to edit. ##### Table</p>
<table class="table">
<thead><tr class="header">
<th>child repo key</th>
<th>child repo</th>
<th>from</th>
<th>until</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>public_MSC_Peter</td>
<td>LEEF.public</td>
<td>12.05.2019</td>
<td></td>
</tr>
<tr class="even">
<td>public_PhD_Mary</td>
<td>LEEF.public</td>
<td>12.05.2022</td>
<td></td>
</tr>
<tr class="odd">
<td>heatwave_e_1</td>
<td>LEEF.heatwave.public</td>
<td>01.01.2019</td>
<td>01.01.2019</td>
</tr>
<tr class="even">
<td>heatwave_private</td>
<td>LEEF.heatwave</td>
<td>01.01.2018</td>
<td>01.01.2020</td>
</tr>
</tbody>
</table>
<div id="yaml-file" class="section level5">
<h5 class="hasAnchor">
<a href="#yaml-file" class="anchor"></a>YAML file</h5>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>public_MSC_Peter<span class="sc">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    from<span class="sc">:</span>  <span class="dv">12</span>.<span class="fl">05.2019</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    until<span class="sc">:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    repo<span class="sc">:</span> LEEF.public</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>public_PhD_Mary<span class="sc">:</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    from<span class="sc">:</span>  <span class="dv">12</span>.<span class="fl">05.2022</span><span class="st">`</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">    until:</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">    repo: LEEF.public</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">heatwave_e_1:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="at">    from:  01.01.2019</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="at">    until: 01.03.2019</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="at">    repo: LEEF.heatwave.public</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="at">heatwave_private:</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="at">    from:  01.01.2018</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="at">    until: 01.01.2020</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="at">    repo: LEEF.heatwave</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="activity-diagrams" class="section level1">
<h1 class="hasAnchor">
<a href="#activity-diagrams" class="anchor"></a>Activity Diagrams</h1>
<div id="import-new-data" class="section level2">
<h2 class="hasAnchor">
<a href="#import-new-data" class="anchor"></a>Import new data</h2>
<div class="figure">
<img src="activity_import.png" style="width:100.0%" alt=""><p class="caption">activity_import</p>
</div>
<div id="check-existing-data-existingdataok" class="section level3">
<h3 class="hasAnchor">
<a href="#check-existing-data-existingdataok" class="anchor"></a>Check existing data (<code>existingDataOK()</code>)</h3>
</div>
<div id="check-new-data-newdataok" class="section level3">
<h3 class="hasAnchor">
<a href="#check-new-data-newdataok" class="anchor"></a>Check new data (<code>newDataOK()</code>
</h3>
</div>
<div id="import-data-importdata" class="section level3">
<h3 class="hasAnchor">
<a href="#import-data-importdata" class="anchor"></a>Import Data (<code>importData()</code>
</h3>
</div>
<div id="publish-data-publishdata" class="section level3">
<h3 class="hasAnchor">
<a href="#publish-data-publishdata" class="anchor"></a>Publish Data (<code>publishData()</code>)</h3>
</div>
</div>
<div id="forecast" class="section level2">
<h2 class="hasAnchor">
<a href="#forecast" class="anchor"></a>Forecast</h2>
<div class="figure">
<img src="activity_forecast.png" style="width:100.0%" alt=""><p class="caption">activity_forecast</p>
</div>
</div>
</div>
<div id="component-diagrams" class="section level1">
<h1 class="hasAnchor">
<a href="#component-diagrams" class="anchor"></a>Component Diagrams</h1>
<div class="figure">
<img src="com_plantuml.png" style="width:100.0%" alt=""><p class="caption">com_plantuml</p>
</div>
</div>
<div id="github-repos" class="section level1">
<h1 class="hasAnchor">
<a href="#github-repos" class="anchor"></a>Github Repos</h1>
<p>Github repos are used to archive the data and the forecasts. They also host the R packege which containe the functionality, but here I will focus on the Data github repos.</p>
<div id="private" class="section level2">
<h2 class="hasAnchor">
<a href="#private" class="anchor"></a>Private</h2>
<p>We need some private repos, as some data will be embargoed for some time due to thesis and publication priorities.</p>
<div id="leef" class="section level3">
<h3 class="hasAnchor">
<a href="#leef" class="anchor"></a>LEEF</h3>
<p>Repo comntaining this document and all information about the other repos and links.</p>
<div id="github-apps" class="section level4">
<h4 class="hasAnchor">
<a href="#github-apps" class="anchor"></a>GitHub apps</h4>
<ul>
<li>Trusted Timestamp for all transactions</li>
</ul>
</div>
</div>
<div id="leef-master" class="section level3">
<h3 class="hasAnchor">
<a href="#leef-master" class="anchor"></a>LEEF.Master</h3>
<p>This repo is used for archiving all data. It will contain the checked and cleaned data. Functions from the Publishing R package can be used to calculate summary stats and show these on a website.</p>
<p>The repo is structured as an R package which contains all the data. In addition, the data is stored in a csv format in the <code>rawData</code> folder for access from other programs. The easiest way to get the updated data is to update the package in R.</p>
<div id="github-apps-1" class="section level4">
<h4 class="hasAnchor">
<a href="#github-apps-1" class="anchor"></a>GitHub apps</h4>
<p>This repo, when receiving a pull request, triggers a Travis-ci build to - check the data contained in the pull request - clean the data contained in the pull request - update the data in the repo if the data is OK and cleaned successfully via a commit as new version. - Trusted Timestamp for all transactions - publishibng of public data to public repo - after updating, forecasting is triggered</p>
</div>
</div>
<div id="forecasts-archiving" class="section level3">
<h3 class="hasAnchor">
<a href="#forecasts-archiving" class="anchor"></a>Forecasts Archiving</h3>
<ul>
<li>get updated data from Archive</li>
<li>calculate forecasts</li>
<li>archive forecasts as new version</li>
<li>publishibng of forecasts based on public data to public repo</li>
<li>Get DOI?</li>
</ul>
<div id="github-apps-2" class="section level4">
<h4 class="hasAnchor">
<a href="#github-apps-2" class="anchor"></a>GitHub apps</h4>
<ul>
<li>Travis-ci to do the forecasts and update the repo afterwards</li>
</ul>
</div>
</div>
</div>
<div id="public" class="section level2">
<h2 class="hasAnchor">
<a href="#public" class="anchor"></a>Public</h2>
<div id="data-archiving" class="section level3">
<h3 class="hasAnchor">
<a href="#data-archiving" class="anchor"></a>Data Archiving</h3>
<div id="github-apps-3" class="section level4">
<h4 class="hasAnchor">
<a href="#github-apps-3" class="anchor"></a>GitHub apps</h4>
</div>
</div>
<div id="forecasts-archiving-1" class="section level3">
<h3 class="hasAnchor">
<a href="#forecasts-archiving-1" class="anchor"></a>Forecasts Archiving</h3>
<div id="github-apps-4" class="section level4">
<h4 class="hasAnchor">
<a href="#github-apps-4" class="anchor"></a>GitHub apps</h4>
</div>
</div>
</div>
</div>
<div id="database-modelling-todo" class="section level1">
<h1 class="hasAnchor">
<a href="#database-modelling-todo" class="anchor"></a>Database Modelling <strong><span style="color:red">TODO</span></strong>
</h1>
<p>Layout Based on <a href="https://gist.github.com/QuantumGhost/0955a45383a0b6c0bc24f9654b3cb561" class="uri">https://gist.github.com/QuantumGhost/0955a45383a0b6c0bc24f9654b3cb561</a></p>
<p><img src="databaseModell.png" width="754"></p>
<div class="figure">
<img src="databaseModell.png" style="width:100.0%" alt=""><p class="caption">databaseModell</p>
</div>
</div>
<div id="r-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#r-packages" class="anchor"></a>R Packages</h1>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
</div>
<div id="data-check-and-cleaning" class="section level2">
<h2 class="hasAnchor">
<a href="#data-check-and-cleaning" class="anchor"></a>Data Check and Cleaning</h2>
<p>See the LEEF.Processing package</p>
</div>
<div id="forecast-1" class="section level2">
<h2 class="hasAnchor">
<a href="#forecast-1" class="anchor"></a>Forecast</h2>
<ul>
<li>Interface for models needs to be defined
<ul>
<li>data structure (S3 methods) for input and putput data</li>
</ul>
</li>
<li>models in separate packages preferable</li>
</ul>
<div class="figure">
<img src="leef.forecast.png" style="width:100.0%" alt=""><p class="caption">leef.forecast</p>
</div>
</div>
<div id="publish" class="section level2">
<h2 class="hasAnchor">
<a href="#publish" class="anchor"></a>Publish</h2>
<div class="figure">
<img src="leef.publish.png" style="width:100.0%" alt=""><p class="caption">leef.publish</p>
</div>
</div>
</div>
<div id="background-info" class="section level1">
<h1 class="hasAnchor">
<a href="#background-info" class="anchor"></a>Background info</h1>
<ul>
<li>Commits have to be signed and contain a trusted timestamp, e.g. 
<ul>
<li><a href="https://proofofexistence.com/" class="uri">https://proofofexistence.com/</a></li>
<li><a href="https://tsa.safecreative.org/" class="uri">https://tsa.safecreative.org/</a></li>
<li><a href="https://www.freetsa.org/index_en.php" class="uri">https://www.freetsa.org/index_en.php</a></li>
<li>this one looks promising: <a href="https://www.npmjs.com/package/gitlock" class="uri">https://www.npmjs.com/package/gitlock</a>
</li>
<li>Some background to Trusted Timestamps <a href="https://d-mueller.de/blog/dealing-with-trusted-timestamps-in-php-rfc-3161/" class="uri">https://d-mueller.de/blog/dealing-with-trusted-timestamps-in-php-rfc-3161/</a>
</li>
<li>bitcoin blockchain <a href="https://www.ideals.illinois.edu/bitstream/handle/2142/73770/478_ready.pdf" class="uri">https://www.ideals.illinois.edu/bitstream/handle/2142/73770/478_ready.pdf</a>
</li>
<li>
<a href="https://github.com/cgwalters/git-evtag" class="uri">https://github.com/cgwalters/git-evtag</a> ?</li>
</ul>
</li>
</ul>
</div>
<div id="part-2---readme2" class="section level1">
<h1 class="hasAnchor">
<a href="#part-2---readme2" class="anchor"></a>Part 2 - README2</h1>
<p>bftools from <a href="https://docs.openmicroscopy.org/bio-formats/5.8.2/users/comlinetools/conversion.html" class="uri">https://docs.openmicroscopy.org/bio-formats/5.8.2/users/comlinetools/conversion.html</a> (2018/06/22)</p>
<hr>
</div>
<div id="todo-6" class="section level1">
<h1 class="hasAnchor">
<a href="#todo-6" class="anchor"></a>TODO</h1>
<div id="move-pre-processors-and-extractors-into-separate-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#move-pre-processors-and-extractors-into-separate-packages" class="anchor"></a>Move <code>pre-processors</code> and <code>extractors</code> into separate packages</h2>
<p>These will contain the functions and the code to add it to the queue for processing. This adds flexibility as additional data sources can be added easier.</p>
</div>
<div id="documentation-and-tests-need-to-be-revised-and-completed" class="section level2">
<h2 class="hasAnchor">
<a href="#documentation-and-tests-need-to-be-revised-and-completed" class="anchor"></a>Documentation and tests need to be revised and completed</h2>
<ul>
<li>
<strong><span style="color:green">DONE</span></strong> revise Tests</li>
<li>revise documentation</li>
</ul>
</div>
<div id="metadata-storage-todo" class="section level2">
<h2 class="hasAnchor">
<a href="#metadata-storage-todo" class="anchor"></a>Metadata storage <strong><span style="color:red">TODO</span></strong>
</h2>
<p>Which metadata should be stored and in which format? Metadata is required at different levels:</p>
<ol style="list-style-type: decimal">
<li>new data package</li>
</ol>
<ul>
<li>date, experiment, who collated the data package (responsible for it), comments, …</li>
<li>linked via the hash used for the TTS</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>data source</li>
</ol>
<ul>
<li>machine, type, version, person who processed the data, comments, …</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>per experiment</li>
</ol>
<ul>
<li>name, person responsible, info about experiment, comments, … How to store the description of the experiment - link to paper / outline?</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>I am sure we need more!!!!!!</li>
</ol>
</div>
<div id="define-database-structure-including-hash-and-id-fields" class="section level2">
<h2 class="hasAnchor">
<a href="#define-database-structure-including-hash-and-id-fields" class="anchor"></a>Define database structure including hash and id fields</h2>
<ol style="list-style-type: decimal">
<li>define fields and linkages between tables</li>
<li>add hash and id fields to <code>.rds</code> files in the <code>LastAdded</code> folder</li>
<li>Write code to write LastAdded to SQLite database</li>
</ol>
</div>
<div id="function-to-request-doi" class="section level2">
<h2 class="hasAnchor">
<a href="#function-to-request-doi" class="anchor"></a>function to request DOI</h2>
<p>This function will publish the data at the is only necessary for public repos, but the functionality needs to be included here. This needs to be done in a github repo - gitlab possible?</p>
</div>
<div id="download-seed-file" class="section level2">
<h2 class="hasAnchor">
<a href="#download-seed-file" class="anchor"></a>Download seed file</h2>
<p>After the TTS is obtained, the seed is downloiaded and saved in the directory as well. This needs to be automated and done later, as the seed is only avvailable about 24 hours after the initial submission.</p>
</div>
<div id="investigate-the-possiblility-of-using-the-gitlab-installation-from-mathematics-department-for-the-local-storage-" class="section level2">
<h2 class="hasAnchor">
<a href="#investigate-the-possiblility-of-using-the-gitlab-installation-from-mathematics-department-for-the-local-storage-" class="anchor"></a>Investigate the possiblility of using the gitlab installation from Mathematics department for the local storage.</h2>
<p>This is unlikely using the current structure and hopefully new options will materialise after the Bern meeting.</p>
</div>
<div id="add-remote-storage-instead-of-sqlite-database" class="section level2">
<h2 class="hasAnchor">
<a href="#add-remote-storage-instead-of-sqlite-database" class="anchor"></a>Add remote storage instead of SQLite database</h2>
<hr>
</div>
</div>
<div id="done" class="section level1">
<h1 class="hasAnchor">
<a href="#done" class="anchor"></a>DONE</h1>
<div id="hashing-and-tts-for-new_data-todo" class="section level2">
<h2 class="hasAnchor">
<a href="#hashing-and-tts-for-new_data-todo" class="anchor"></a>Hashing and TTS for new_data <strong><span style="color:red">TODO</span></strong>
</h2>
<p>Request TTS (Trusted Time Stamp) is obtained from <code>archive_new_data()</code> and is stored in the samd directory as the archive</p>
</div>
<div id="build-hash-checksum-of-archive" class="section level2">
<h2 class="hasAnchor">
<a href="#build-hash-checksum-of-archive" class="anchor"></a>build hash / checksum of archive</h2>
<p>This is used only to checksum the archive and for obtaining the TTS for the archive hash.</p>
</div>
<div id="pre-processing-of-data" class="section level2">
<h2 class="hasAnchor">
<a href="#pre-processing-of-data" class="anchor"></a>Pre-processing of data</h2>
<p>Conversion to open formats for archiving and fuerther procesing</p>
</div>
<div id="extraction-of-data" class="section level2">
<h2 class="hasAnchor">
<a href="#extraction-of-data" class="anchor"></a>Extraction of data</h2>
<p>Extraction of dat and storage in data.table / tibble for addition to database</p>
</div>
<div id="confirm-on-what-raw-data-is-for-archiving-doi" class="section level2">
<h2 class="hasAnchor">
<a href="#confirm-on-what-raw-data-is-for-archiving-doi" class="anchor"></a>Confirm on what <code>raw data</code> is for archiving, DOI, …</h2>
<p>At the moment, data is converted from proprietory to open formats and archived afterwards.</p>
</div>
<div id="done-revise-configuration-and-initialisation" class="section level2">
<h2 class="hasAnchor">
<a href="#done-revise-configuration-and-initialisation" class="anchor"></a><strong><span style="color:green">DONE</span></strong> — revise configuration and initialisation</h2>
<p>Remove the <code>CONFIG.NAME</code> file and incorporate it in the <code>config.yml</code> file.</p>
<p>Configuration should be done by running a <code>initialize_db()</code> function which 1) reads <code>config.yml</code> from working directory 2) creates directory structure (if not already existing) 3) creates empty database (if not slready existing) 4) adds <code>pre-processors</code>, <code>extractors</code>, … This will make the usage of different databases much easier and the package much more versatile</p>
<hr>
</div>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This repo contains an R package for</p>
<ul>
<li>importing new data into the data base</li>
<li>accessing the data base</li>
</ul>
<p>which contains data from the experiments.</p>
<p>It only contains the infrastructure, while the source specific processing is provided by source specific packages which are called from this package.</p>
<p>The data is stored locally in a directory structure an SQLite database, but remote storage is planned.</p>
<p>Functions which need to be called by the user are: * <code>initialize_db()</code>: to read the config file and to setup the needed directory structure * <code>import_new_data()</code>: to import new data * <strong><span style="color:red">TODO</span></strong> `</p>
<ol style="list-style-type: decimal">
<li>import of new data</li>
<li>request new foreacasts</li>
</ol>
</div>
<div id="dependencies" class="section level1">
<h1 class="hasAnchor">
<a href="#dependencies" class="anchor"></a>Dependencies</h1>
<div id="bioconductor-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#bioconductor-packages" class="anchor"></a>bioconductor packages</h2>
<p>The extaction of the data from the flowcytometer depends on bioconductor packages. They can be ionstalled as followed (details see <a href="https://bioconductor.org/install/#install-bioconductor-packages" class="uri">https://bioconductor.org/install/#install-bioconductor-packages</a> )</p>
<p>It is also possible, that the following packages have to be installed by hand:</p>
</div>
</div>
<div id="installation-of-r-package" class="section level1">
<h1 class="hasAnchor">
<a href="#installation-of-r-package" class="anchor"></a>Installation of R package</h1>
<div id="prerequisites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>As the package is only on github, you need <code>devtools</code> to install it easily as a prerequisite</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></code></pre></div>
</div>
<div id="installation-of-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#installation-of-the-package" class="anchor"></a>Installation of the package</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"rkrug/LEEF"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="usage-of-package" class="section level1">
<h1 class="hasAnchor">
<a href="#usage-of-package" class="anchor"></a>Usage of package</h1>
<div id="initialization" class="section level2">
<h2 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization</h2>
<p>The package needs some information to be able to handle the import, storage and retrieval of the data. This information is stored in a file called by default <code>config.yml</code>.</p>
<p>The default <code>config.yml</code> included in the package looks as followed:</p>
<pre><code>  [1] "# General info"                                                                                                 
  [2] "# --------------------------------------------------------------------"                                         
  [3] "# General info regarding the processing"                                                                        
  [4] ""                                                                                                               
  [5] ""                                                                                                               
  [6] "name: LEEF"                                                                                                     
  [7] "description: LEEF Data from an long term experiment."                                                           
  [8] "             Some more detaled info has to follow."                                                             
  [9] "maintainer: Rainer M. Krug &lt;Rainer@uzh.ch&gt;"                                                                     
 [10] ""                                                                                                               
 [11] ""                                                                                                               
 [12] "# --------------------------------------------------------------------"                                         
 [13] "# Directorie for the processing"                                                                                
 [14] "# --------------------------------------------------------------------"                                         
 [15] "## The folder structure in this directory"                                                                      
 [16] "## has to be one folder for each measurement type."                                                             
 [17] "##"                                                                                                             
 [18] ""                                                                                                               
 [19] ""                                                                                                               
 [20] "directories:"                                                                                                   
 [21] "  general.parameter: \"00.general.parameter\""                                                                  
 [22] "  raw: \"0.raw.data\""                                                                                          
 [23] "  pre_processed: \"1.pre-processed.data\""                                                                      
 [24] "  extracted: \"2.extracted.data\""                                                                              
 [25] "  archive: \"3.archived.data\""                                                                                 
 [26] "  backend: \"9.backend\""                                                                                       
 [27] "  tools: \"tools\""                                                                                             
 [28] ""                                                                                                               
 [29] ""                                                                                                               
 [30] "# --------------------------------------------------------------------"                                         
 [31] "# Packages which contain the pre_processors, extractors, additors, ..."                                         
 [32] "# --------------------------------------------------------------------"                                         
 [33] "# These will be installed using the `InstallCommand` and registered"                                            
 [34] "# in the queue using the `RegisterCommand`."                                                                    
 [35] "# The RegisterCommand` can also contain additional customizations needed by the processors."                    
 [36] ""                                                                                                               
 [37] ""                                                                                                               
 [38] "measurement_packages:"                                                                                          
 [39] "  LEEF.measurement.bemovi:"                                                                                     
 [40] "    name: LEEF.measurement.bemovi"                                                                              
 [41] "    InstallCommand: drat::addRepo('LEEF-UZH'); install.packages('LEEF.measurement.bemovi')"                     
 [42] "    RegisterCommand: LEEF.measurement.bemovi::tools_path(tools_path = '.'); LEEF.measurement.bemovi::register()"
 [43] "  LEEF.measurement.flocam:"                                                                                     
 [44] "    name: LEEF.measurement.flowcam"                                                                             
 [45] "    InstallCommand: drat::addRepo('LEEF-UZH'); install.packages(('LEEF.measurement.flowcam')"                   
 [46] "    RegisterCommand: LEEF.measurement.flowcam::register()"                                                      
 [47] "  LEEF.measurement.flowcytometer:"                                                                              
 [48] "    name: LEEF.measurement.flowcytometer"                                                                       
 [49] "    InstallCommand: drat::addRepo('LEEF-UZH'); install.packages('LEEF.measurement.flowcytometer')"              
 [50] "    RegisterCommand: LEEF.measurement.flowcytometer::register()"                                                
 [51] "  LEEF.measurement.manualcount:"                                                                                
 [52] "    name: LEEF.measurement.manualcount"                                                                         
 [53] "    InstallCommand: drat::addRepo('LEEF-UZH'); install.packages('LEEF.measurement.manualcount')"                
 [54] "    RegisterCommand: LEEF.measurement.manualcount::register()"                                                  
 [55] "  LEEF.measurement.o2meter:"                                                                                    
 [56] "    name: LEEF.measurement.o2meter"                                                                             
 [57] "    InstallCommand: drat::addRepo('LEEF-UZH'); install.packages('LEEF.measurement.o2meter')"                    
 [58] "    RegisterCommand: LEEF.measurement.o2meter::register()"                                                      
 [59] ""                                                                                                               
 [60] ""                                                                                                               
 [61] ""                                                                                                               
 [62] "# --------------------------------------------------------------------"                                         
 [63] "# archival_packages"                                                                                            
 [64] "# --------------------------------------------------------------------"                                         
 [65] "# These will be installed using the `InstallCommand` and registered"                                            
 [66] "# in the queue using the `RegisterCommand`."                                                                    
 [67] "# The RegisterCommand` can also contain additional customizations needed by the processors."                    
 [68] "# Additional values are archival package specific."                                                             
 [69] ""                                                                                                               
 [70] ""                                                                                                               
 [71] "archive_packages:"                                                                                              
 [72] "  LEEF.archive.default:"                                                                                        
 [73] "    name: LEEF.archive.default"                                                                                 
 [74] "    InstallCommand: drat::addRepo('LEEF-UZH'); install.packages('LEEF.archive.default')"                        
 [75] "    RegisterCommand: LEEF.archive.default::register(compression = \"none\")"                                    
 [76] ""                                                                                                               
 [77] "# --------------------------------------------------------------------"                                         
 [78] "# backend packages ()"                                                                                          
 [79] "# --------------------------------------------------------------------"                                         
 [80] "# These will be installed using the `InstallCommand` and registered"                                            
 [81] "# in the queue using the `RegisterCommand`."                                                                    
 [82] "# The RegisterCommand` can also contain additional customizations needed by the processors."                    
 [83] "# Additional values are arcival package specific."                                                              
 [84] ""                                                                                                               
 [85] "## NOT IMPLEMENTED YET"                                                                                         
 [86] "## SOME MORE THOUGHT NEEDED HERE!"                                                                              
 [87] ""                                                                                                               
 [88] ""                                                                                                               
 [89] "backend_packages:"                                                                                              
 [90] "  LEEF.backend.csv:"                                                                                            
 [91] "    name: LEEF.backend.csv"                                                                                     
 [92] "    InstallCommand: drat::addRepo('LEEF-UZH'); install.packages('LEEF.backend.csv')"                            
 [93] "    RegisterCommand: LEEF.backend.csv::register()"                                                              
 [94] "  # LEEF.backend.sqlite:"                                                                                       
 [95] "  #   name: LEEF.backend.sqlite"                                                                                
 [96] "  #   InstallCommand: drat::addRepo('LEEF-UZH'); install.packages('LEEF.backend.sqlite')"                       
 [97] "  #   RegisterCommand: LEEF.backend.sqlite::register()"                                                         
 [98] "  #   dbpath:"                                                                                                  
 [99] "  #   dbname: 'LEEFData.sqlite'"                                                                                
[100] ""                                                                                                               
[101] ""                                                                                                               
[102] "# --------------------------------------------------------------------"                                         
[103] "# Trusted Time Stamps"                                                                                          
[104] "# --------------------------------------------------------------------"                                         
[105] "## NOT IMPLEMENTED YET"                                                                                         
[106] "## SOME MORE THOUGHT NEEDED HERE!"                                                                              
[107] ""                                                                                                               
[108] ""                                                                                                               
[109] "tts:"                                                                                                           
[110] "  create: TRUE"                                                                                                 
[111] "  api_key: PRIVATE"                                                                                             
[112] "  notification:"                                                                                                
[113] "    notification_type: 0"                                                                                       
[114] "    target: tsg@LEEF-UZH.ch"                                                                                    
[115] ""                                                                                                               
[116] ""                                                                                                               
[117] "# --------------------------------------------------------------------"                                         
[118] "# DOI"                                                                                                          
[119] "# --------------------------------------------------------------------"                                         
[120] "## NOT IMPLEMENTED YET"                                                                                         
[121] ""                                                                                                               
[122] ""                                                                                                               
[123] "doi: FALSE"                                                                                                     
[124] ""                                                                                                               
[125] "# --------------------------------------------------------------------"                                         
[126] "# queues containing functions"                                                                                  
[127] "# --------------------------------------------------------------------"                                         
[128] "## These should be left blank, as they WILL be owerwritten."                                                    
[129] ""                                                                                                               
[130] ""                                                                                                               
[131] "queues:"                                                                                                        
[132] "  pre_processors:"                                                                                              
[133] "  extractors:"                                                                                                  
[134] "  archivers:"                                                                                                   
[135] "  additors:"                                                                                                    
[136] ""                                                                                                               </code></pre>
<p>The fastest way to start a new data storage infrastructure is to create an empty directory and to copy the config file into this directory. Afterwards, change the working directory to that directoryt and initialise the folder structure and the package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># library("LEEF")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/load_all.html">load_all</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">nd</span> <span class="op">&lt;-</span> <span class="st">"Data_directory"</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span> <span class="va">nd</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span> <span class="va">nd</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"config.yml"</span>, package <span class="op">=</span> <span class="st">"LEEF"</span><span class="op">)</span>,
  to <span class="op">=</span> <span class="st">"."</span>
<span class="op">)</span>
<span class="fu">initialize_db</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>After that, the data to be imported can be placed into the ToBeImported folder and imported by calling</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">import_new_data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The <code>ToBeImported</code> folder contains subfolder, which are equal to the name of the table in the database where the results will be imported to. Details will follow later.</p>
</div>
</div>
<div id="import-new-data-1" class="section level1">
<h1 class="hasAnchor">
<a href="#import-new-data-1" class="anchor"></a>Import new data</h1>
<p>Data can be imported from the folder</p>
</div>
<div id="infrastructure" class="section level1">
<h1 class="hasAnchor">
<a href="#infrastructure" class="anchor"></a>Infrastructure</h1>
<div id="configuration-files-of-the-infrastructure" class="section level2">
<h2 class="hasAnchor">
<a href="#configuration-files-of-the-infrastructure" class="anchor"></a>Configuration files of the infrastructure</h2>
<div id="config-yml" class="section level3">
<h3 class="hasAnchor">
<a href="#config-yml" class="anchor"></a><code>config.yml</code>
</h3>
<p>In the <code>config.yml</code> file are all configuration options of the infrastructure. The example one looks as follow:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>default<span class="sc">:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  maintainer<span class="sc">:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    name<span class="sc">:</span> Max Mustermann</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    email<span class="sc">:</span> Max<span class="sc">@</span>musterfabrik.example</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  description<span class="sc">:</span> This is my fantastic repo</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>               with lots of data.</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>master<span class="sc">:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  doi<span class="sc">:</span> <span class="cn">FALSE</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  tts<span class="sc">:</span> <span class="cn">TRUE</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">:</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    backend<span class="sc">:</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      mysql<span class="sc">:</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        Database<span class="sc">:</span> <span class="st">"[database name]"</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        UID<span class="sc">:</span> <span class="st">"[user id]"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        PWD<span class="sc">:</span> <span class="st">"[pasword]"</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        Port<span class="sc">:</span> <span class="dv">3306</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>LEEF<span class="sc">:</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  doi<span class="sc">:</span> <span class="cn">TRUE</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  tts<span class="sc">:</span> <span class="cn">TRUE</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">:</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    backend<span class="sc">:</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      sqlite<span class="sc">:</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        folder<span class="sc">:</span> inst<span class="sc">/</span>extdata</span></code></pre></div>
<div class="figure">
<img src="leef.import.activity.png" style="width:100.0%" alt=""><p class="caption">leef.import.activity</p>
</div>
<p>The top levels are different repo names (here <code>master</code> and <code>LEEF</code>) and default values for all the repos (<code>default</code>).</p>
<p>It has the following keywords: - <code>default</code> contaiuns self-explanatory values - <code>doi</code> if TRUE, will request DOI after successfull commit - <code>tts</code> if TRUE, will request Trusted Time Stamp of repo after successfull commit - <code>data</code> contains info about the data storage - <code>backend</code> the name of the backend and connection info - <span style="color:green">others to come</span></p>
<p>This config file should be the same for all repos in a tree, but it is not necessary.</p>
</div>
<div id="config-name" class="section level3">
<h3 class="hasAnchor">
<a href="#config-name" class="anchor"></a><code>CONFIG.NAME</code>
</h3>
<p>This file contains the name of the configuration for this repo. in this example <code>master</code>. So by changiong the content of this file to <code>LEEF</code>, this repo becomes a <code>LEEF</code> repo.</p>
</div>
</div>
<div id="import-of-new-data" class="section level2">
<h2 class="hasAnchor">
<a href="#import-of-new-data" class="anchor"></a>Import of new data</h2>
<p>Before new data can be imported, this repo needs to be forked. Once forked, all user interaction takes place via this fork and pull requests to this repo. This fork needs to be cloned to a local computer.</p>
<p>An import of new data follows the following steps:</p>
<ol style="list-style-type: decimal">
<li>Create a new branch on the local fork and check it out.</li>
<li>Add all new data files to the directory <code>inst/new_data/</code>. The data has to follow the following rules:
<ul>
<li>the data has to be in a common format, e.g. <code>.csv</code>
</li>
<li>the name has to reflect the name of the table the data needs to be imported to</li>
<li><strong><span style="color:red">metadata do be added in additional file?</span></strong></li>
<li><strong><span style="color:red">more?</span></strong></li>
</ul>
</li>
<li>commit these changes to the local fork and push to github fork</li>
<li>create pull request from this repo</li>
<li>an automatic check of the package will be triggered using Travis-ci, which will test the data and not the units if the <code>inst/newdata</code> directory is not empty</li>
<li>From now on in the <code>after_success section</code>
</li>
<li>after a succerssfull testhat test, the data will be imported and the database updated</li>
<li>delete all imported files; if a file remains, raise error</li>
<li>update version in DESCRIPTION</li>
<li>the main vignette will be updated with date and (hopefully) timestamp of the data</li>
<li>changes will be commited to repo with</li>
<li>quit</li>
</ol>
<p>As soon as this repo receives a pull request, it initiates the import via a Travis job. This importing is handled within the package <code>LEEF.Processing</code> and can be seen in detail in the package documantation.</p>
<p>For relevance here are two actions:</p>
<ol style="list-style-type: decimal">
<li>
<code>LEEF.Processing</code> does commit the imported data to this repository or to the external database.</li>
</ol>
</div>
</div>
<div id="package-structure" class="section level1">
<h1 class="hasAnchor">
<a href="#package-structure" class="anchor"></a>Package structure</h1>
<p>The Data package contains the code to</p>
<ul>
<li>
<code>check_existing_...()</code> to check the existing data</li>
<li>
<code>check_new_...()</code> to check the incoming new data</li>
<li>
<code>merge_...()</code> to merge the new data into the existing data</li>
<li>…</li>
</ul>
<p>In addition, it contains the function</p>
<ul>
<li>
<code>existing_data_ok()</code> which is doing all checks on the existing data</li>
<li>
<code>newData_ok()</code> which is doing all checks on the new data</li>
<li>
<code>merge_all()</code> which is doing all the merging</li>
</ul>
<p>and finally</p>
<ul>
<li>
<code>do_all()</code> which is doing everything in the order of
<ol style="list-style-type: decimal">
<li><code>check_existing_data()</code></li>
<li><code>check_new_data()</code></li>
<li>
<code>merge_all()</code><br>
</li>
<li><code>existing_data_ok()</code></li>
</ol>
</li>
</ul>
<div class="figure">
<img src="leef.processing.content.png" style="width:100.0%" alt=""><p class="caption">leef.processing.content</p>
</div>
<div id="activity-diagram-of-import_new_data-function" class="section level2">
<h2 class="hasAnchor">
<a href="#activity-diagram-of-import_new_data-function" class="anchor"></a>Activity Diagram of <code>import_new_data()</code> function</h2>
</div>
</div>
<div id="database-structure" class="section level1">
<h1 class="hasAnchor">
<a href="#database-structure" class="anchor"></a>Database Structure</h1>
<p>Layout Based on <a href="https://gist.github.com/QuantumGhost/0955a45383a0b6c0bc24f9654b3cb561" class="uri">https://gist.github.com/QuantumGhost/0955a45383a0b6c0bc24f9654b3cb561</a></p>
<div class="figure">
<img src="databaseModell2.png" style="width:100.0%" alt=""><p class="caption">databaseModell2</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rainer M. Krug.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
